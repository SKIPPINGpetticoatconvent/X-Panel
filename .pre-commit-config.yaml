fail_fast: true

repos:
  # Go 代码检查 - 使用 managed golang 环境
  - repo: local
    hooks:
      - id: golangci-lint
        name: golangci-lint
        entry: golangci-lint
        language: system
        args: [run, --timeout=10m]
        types: [go]
        pass_filenames: false

  # Go 格式检查
  - repo: local
    hooks:
      - id: gofmt
        name: gofmt
        entry: gofmt
        language: system
        args: [-w, -s]
        types: [go]

      - id: go-vet
        name: go vet
        entry: go
        language: system
        args: [vet, ./...]
        types: [go]
        pass_filenames: false

      - id: go-mod-tidy
        name: go mod tidy
        entry: go
        language: system
        args: [mod, tidy]
        types: [go]
        pass_filenames: false
        files: go\.(mod|sum)$

  # Shell 脚本检查 - 使用系统安装的 shellcheck
  - repo: local
    hooks:
      - id: shellcheck
        name: shellcheck
        entry: shellcheck
        language: system
        types: [shell]

      - id: shfmt
        name: shfmt
        entry: shfmt
        language: system
        args: [-i, "2", -w, -s]
        types: [shell]

  # Commit message 检查 - 使用内置实现
  - repo: https://github.com/compilerla/conventional-pre-commit
    rev: v3.0.0
    hooks:
      - id: conventional-pre-commit
        stages: [commit-msg]
        args:
          [
            feat,
            fix,
            docs,
            style,
            refactor,
            perf,
            test,
            build,
            ci,
            chore,
            revert,
          ]

# 排除特定目录
exclude: |
  (?x)^(
    vendor/|
    \.git/|
    \.githooks/|
    \.githooks\.backup/|
    node_modules/|
    build/|
    dist/
  )$

# CI 配置
ci:
  autofix_commit_msg: |
    chore: auto-fix from prek hooks

  skip:
    - go-mod-tidy
    - conventional-commit-msg
